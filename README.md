# Redmine Monitoring

Плагин для Redmine, который перехватывает все ошибки приложения (включая HTTP-ошибки), сохраняет их в базу и предоставляет удобный интерфейс для просмотра.

## Возможности

- **Глобальный перехват ошибок** через middleware:
  - исключения (`StandardError`, `RuntimeError`, `ActiveRecord::RecordInvalid` и т.п.);
  - HTTP-статусы 4xx и 5xx.
- **Сохранение информации** в таблицу `monitoring_errors`:
  - класс и сообщение ошибки;
  - backtrace;
  - контроллер/действие (`EvdSystemsController#index`);
  - статус ответа (`500`, `404` и др.);
  - пользователь (если авторизован);
  - параметры запроса (`params`);
  - заголовки (`headers`);
  - окружение (`Rails.env`);
  - IP, User-Agent, Referer.
- **UI в админке Redmine**:
  - список последних ошибок с пагинацией;
  - раскрытие деталей по клику;
  - подсветка и форматирование JSON (params, headers);
  - кнопка «копировать» для сниппетов;
  - фильтрация по количеству записей на страницу.
- **Кнопка "Создать тестовую ошибку"** для проверки работы в Режиме разработки.
- **Кнопка "Очистить"** для удаления всех ошибок.
- **Настройки плагина**:
  - включение/выключение мониторинга;
  - режим разработки.

---

## Установка

1. Клонируйте репозиторий в каталог `plugins` Redmine:

   ```bash
   cd redmine/plugins
   git clone https://github.com/skyrusx/redmine_monitoring.git
   ```

2. Выполните миграции:

   ```bash
   bundle exec rake redmine:plugins:migrate
   ```

3. Перезапустите Redmine.

---

## Использование

- Перейдите в меню **Администрирование → Плагины → Redmine Monitoring plugin**.
- Включите мониторинг в настройках.
- Откройте страницу `/monitoring`, чтобы увидеть список ошибок.
- Используйте кнопку «Создать тестовую ошибку» для проверки.

---

## API / Технические детали

- Middleware `RedmineMonitoring::Middleware` ловит ошибки.
- Контроллер `MonitoringErrorsController`:
  - `index` — список ошибок;
  - `show` — просмотр одной ошибки;
  - `test_error` — создание тестовой ошибки;
  - `clear` — очистка всех ошибок (POST).
- Модель `MonitoringError` хранит все данные об ошибке.

---

## Настройки (settings)

- `enabled` — включить/выключить мониторинг (по умолчанию `true`).
- `dev_mode` — режим разработки (по умолчанию `false`).

---

## Совместимость

- Redmine 4.x / 5.x  
- Ruby 2.6+  
- PostgreSQL / MySQL  

---

## Лицензия

[MIT](LICENSE.txt)
